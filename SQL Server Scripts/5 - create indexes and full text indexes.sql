-- DVD Store Database Version 2.1 Build, Load and Create Index Script - SQL Server version - Large DB, 4 LUNs
-- Copyright (C) 2007 Dell, Inc. <dave_jaffe@dell.com> and <tmuirhead@vmware.com>
-- Last updated 08/33/2012
-- adds all indexes including full text indexes. 
-- you should run this after the bulk load but before you create the stored procedures
-- or there will be errors thrown by the stored procedure create statements.

USE DS2
GO

ALTER TABLE CATEGORIES ADD CONSTRAINT PK_CATEGORIES PRIMARY KEY CLUSTERED 
(
CATEGORY
)  
   
GO

ALTER TABLE CUSTOMERS ADD CONSTRAINT PK_CUSTOMERS PRIMARY KEY CLUSTERED 
(
CUSTOMERID
)  
   
GO

CREATE UNIQUE INDEX IX_CUST_UN_PW ON CUSTOMERS 
(
USERNAME, 
PASSWORD
)
  
GO

CREATE INDEX IX_CUST_HIST_CUSTOMERID ON CUST_HIST
(
CUSTOMERID
)
  
GO

CREATE INDEX IX_CUST_HIST_CUSTOMERID_PRODID ON CUST_HIST 
(
CUSTOMERID ASC,
PROD_ID ASC
)
  
GO

ALTER TABLE CUST_HIST WITH NOCHECK
ADD CONSTRAINT FK_CUST_HIST_CUSTOMERID  FOREIGN KEY (CUSTOMERID)
REFERENCES CUSTOMERS (CUSTOMERID)
ON DELETE CASCADE
GO

ALTER TABLE ORDERS ADD CONSTRAINT PK_ORDERS PRIMARY KEY CLUSTERED 
(
	ORDERID
)  
GO

CREATE INDEX IX_ORDER_CUSTID ON ORDERS
(
CUSTOMERID
)
  
GO

ALTER TABLE ORDERLINES WITH NOCHECK ADD CONSTRAINT PK_ORDERLINES PRIMARY KEY CLUSTERED 
(
ORDERID,
ORDERLINEID
)  
GO

ALTER TABLE ORDERLINES WITH NOCHECK ADD CONSTRAINT FK_ORDERID FOREIGN KEY (ORDERID)
REFERENCES ORDERS (ORDERID)
ON DELETE CASCADE
GO

ALTER TABLE INVENTORY WITH NOCHECK ADD CONSTRAINT PK_INVENTORY PRIMARY KEY CLUSTERED 
(
PROD_ID
)  
   
GO

ALTER TABLE PRODUCTS WITH NOCHECK ADD CONSTRAINT PK_PRODUCTS PRIMARY KEY CLUSTERED 
(
PROD_ID
)  
   
GO

CREATE INDEX IX_PROD_PRODID ON PRODUCTS 
(
PROD_ID ASC
)
INCLUDE (TITLE)
  
GO

CREATE INDEX IX_PROD_PRODID_COMMON_PRODID ON PRODUCTS 
(
PROD_ID ASC,
COMMON_PROD_ID ASC
)
INCLUDE (TITLE, ACTOR)
  
GO

CREATE INDEX IX_PROD_SPECIAL_CATEGORY_PRODID ON PRODUCTS 
(
SPECIAL ASC,
CATEGORY ASC,
PROD_ID ASC
)
INCLUDE (TITLE, ACTOR, PRICE, COMMON_PROD_ID)
  
GO


EXEC sp_fulltext_database 'enable'
EXEC sp_fulltext_catalog 'FULLTEXTCAT_DSPROD', 'create', 'h:\FullText'
EXEC sp_fulltext_table 'PRODUCTS', 'create', 'FULLTEXTCAT_DSPROD', 'PK_PRODUCTS'
EXEC sp_fulltext_column 'PRODUCTS', 'ACTOR', 'add'
EXEC sp_fulltext_column 'PRODUCTS', 'TITLE', 'add'
EXEC sp_fulltext_table 'PRODUCTS', 'activate'
EXEC sp_fulltext_catalog 'FULLTEXTCAT_DSPROD', 'start_full'
GO

CREATE INDEX IX_PROD_CATEGORY ON PRODUCTS 
(
CATEGORY
)
  
GO

CREATE INDEX IX_PROD_SPECIAL ON PRODUCTS
(
SPECIAL
)
  
GO

CREATE STATISTICS stat_cust_cctype_username ON CUSTOMERS(CREDITCARDTYPE, USERNAME)
GO
CREATE STATISTICS stat_cust_cctype_customerid ON CUSTOMERS(CREDITCARDTYPE, CUSTOMERID)
GO
CREATE STATISTICS stat_prod_prodid_special ON PRODUCTS(PROD_ID, SPECIAL)
GO
CREATE STATISTICS stat_prod_category_prodid ON PRODUCTS(CATEGORY, PROD_ID)
GO


